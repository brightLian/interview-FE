# 浏览器相关知识点

### 前言

作为一名前端开发人员，我们有一半以上的工作是与浏览器有关的，因此很有必要对与浏览器相关原理进行一些深入的学习。

本章的知识不是很难，大多数是一些概念性的知识，主要页面的重排重绘、渲染过程、跨域等相关内容。

### 从输入一个 URL 到展示的过程？:star2:

- 浏览器先根据用户输入的 URL 读取缓存。
  - 从浏览器缓存、系统缓存、路由器缓存进行读取，如果有直接渲染页面
- 浏览器通过网址进行域名解析，查找对应的 IP 地址。
  - 先查看本地的 host 文件，是否有和这个网址的对应关系，有则直接使用这个 IP
  - 本地文件没有则向本地 DNS 服务器发送请求，一层一层查找后返回 IP 地址
  - 在这个步骤的时候会先判断是否存在 DNS 缓存
- 浏览器和服务器建立 TCP 链接。
  - TCP 连接需要进行三次握手
- 浏览器根据 IP 地址向服务器发送 HTTP 请求。
  - 在发起请求前先判断强缓存是否存在，如果未过期，直接使用资源不发起请求
- 服务器处理请求，返回相关信息给浏览器。
  - 服务器接受请求后，先判断资源是否被重定向
  - 再判断请求中的信息是否命中协商缓存
  - 命中协商缓存后返回304状态码，没有命中则返回资源信息以及新的缓存标识
- 浏览器收到资源后，对资源进行解析并渲染页面。
  - 浏览器解析各种类型的文件，然后对页面进行渲染
- 浏览器和服务器断开 TCP 连接。
  - TCP 断开连接需要进行四次挥手

### 浏览器的渲染过程

- 渲染过程的关键路径
  - 解析 HTML 生成 DOMTree
  - 解析 CSS 生成 CSSTree
  - 将 DOMTree 和 CSSTree 结合生成 renderTree
  - 根据 renderTree 开始对页面进行布局，计算每个节点对信息
  - 根据节点信息进行分层绘制
  - 不同的层复合后形成页面
- 渲染阻塞：浏览器遇到 script 标签后，DOM 构建会暂停，等待脚本完成后继续渲染。

### window.onload 和 DOMContentLoaded 的区别:star2:

window.onload 事件在页面全部资源加载完成才会执行，包括图片、视频等资源。

DOMContentLoaded 在 DOM 渲染完成后执行，此时图片、视频还可能没加载完。

### 什么是同源策略及限制？

同源策略：用于限制一个源的文档或者加载的脚本是否可以和另一个源进行交互。

同源：同源指的是协议 + 域名 + 端口都相同的情况。

限制：当发起请求的源与被请求的源不同时，会出现跨域问题，称为限制。

### 如何解决跨域问题:star2:

注意一个大原则：所有的跨域问题都必须经过 server 端的允许和配合。

- JSONP
  - 利用动态创建 script 标签，不受跨域的影响，但是只能发送 GET 请求。
  - 服务器可以任意动态拼接数据返回。




